<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link
      rel="shortcut icon"
      href="https://home.jnj.com/Fallback/Assets/favicon.ico"
      type="image/x"
    />
    <link
      rel="icon"
      href="https://home.jnj.com/Fallback/Assets/favicon.ico"
      type="image/x"
    />

    <title>MDM Smart Form</title>

    <style>
      :root {
        --primary: #eb1700;
        --primary2: #8f3b8f;
        --border: #b8b8b8;
        --bg: #f4f4f6;
        --panel: #fff;
        --label: #2b2b2b;
        --muted: #6b6b6b;
        --danger: #9e0000;
        --ok: #1b7a1b;
        --header: #efefef;
        --shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        --modal-backdrop: rgba(0, 0, 0, 0.5);
        --modal-bg: #ffffff;
        --modal-max-width: 560px;
        --modal-radius: 12px;
        --modal-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      }

      * {
        box-sizing: border-box;
      }

      @font-face {
        font-family: 'Johnsons Display';
        src: url('https://db.onlinewebfonts.com/t/72b25938efe4a4c61d68573df9bd1450.eot');
        src: url('https://db.onlinewebfonts.com/t/72b25938efe4a4c61d68573df9bd1450.eot?#iefix')
            format('embedded-opentype'),
          url('https://db.onlinewebfonts.com/t/72b25938efe4a4c61d68573df9bd1450.woff2')
            format('woff2'),
          url('https://db.onlinewebfonts.com/t/72b25938efe4a4c61d68573df9bd1450.woff')
            format('woff'),
          url('https://db.onlinewebfonts.com/t/72b25938efe4a4c61d68573df9bd1450.ttf')
            format('truetype'),
          url('https://db.onlinewebfonts.com/t/72b25938efe4a4c61d68573df9bd1450.svg#Johnson Display')
            format('svg');
      }

      body {
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: var(--bg);
        font-family: 'Johnsons Display', Arial, sans-serif;
        color: #111;
      }

      .wrap {
        width: 1200px;
        margin: 18px auto;
        padding: 14px;
      }

      /* Backdrop */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: var(--modal-backdrop);
        display: none; /* hidden by default */
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal-backdrop.is-open {
        display: block;
      }

      /* Modal container */
      .modal {
        background: var(--modal-bg);
        width: min(92vw, var(--modal-max-width));
        border-radius: var(--modal-radius);
        box-shadow: var(--modal-shadow);
        overflow: hidden;
        transform: translateY(10px);
        opacity: 0;
        transition: opacity 150ms ease, transform 150ms ease;

        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%); /* centers both axes */
        width: min(92vw, var(--modal-max-width));
      }
      .modal-backdrop.is-open .modal {
        transform: translateY(0);
        opacity: 1;
      }

      /* Modal header/body/footer */
      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.25rem;
        border-bottom: 1px solid #e9eef5;
      }
      .modal-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
      }
      .modal-body {
        padding: 1rem 1.25rem;
        font-weight: 200px;
      }
      .modal-footer {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
        padding: 1rem 1.25rem;
        border-top: 1px solid #e9eef5;
        background: #fafbfc;
      }

      .topbar,
      .progress-wrap,
      form {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 10px;
        box-shadow: var(--shadow);
      }

      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        padding: 14px 16px;
      }

      .brand {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .brand .name {
        font-size: 34px;
        font-weight: 800;
        color: #c74a4a;
        font-family: 'Trebuchet MS', Arial;
      }
      .brand .sub {
        font-size: 12px;
        color: var(--muted);
        font-weight: 800;
        letter-spacing: 0.8px;
      }
      a {
        color: #eb1700;
      }
      .primary-text {
        color: #9e0000;
        font-size: 12px;
      }

      .jnj-text {
        color: #eb1700;
      }

      .disclaimer-header {
        color: #eb1700;
        font-size: 13px;
        margin-bottom: 4px;
      }
      .btn-close {
        color: white !important;
        background-color: #eb1700 !important;
        border: 1px solid #9e0000 !important;
        font-size: 12px;
      }
      .right-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .btn {
        border: 1px solid #2d6ea3;
        background: #004685;
        color: #fff;
        padding: 8px 15px;
        font-weight: 600;
        border-radius: 6px;
        cursor: pointer;
        user-select: none;
      }
      .btn.secondary {
        border-color: #4a8f4a;
        background: #53a453;
      }
      .btn.ghost {
        border-color: #9aa3aa;
        background: #e8ecef;
        color: #1b1b1b;
      }
      .btn.danger {
        border-color: #b00020;
        background: #b00020;
      }
      .btn.small {
        padding: 8px 10px;
        font-size: 12px;
        border-radius: 8px;
      }
      .btn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }

      .progress-wrap {
        margin-top: 12px;
        padding: 12px 14px;
      }
      .progress-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }
      .progressbar {
        flex: 1;
        min-width: 280px;
        height: 12px;
        border-radius: 999px;
        background: #e6e6e9;
        border: 1px solid #d2d2d6;
        overflow: hidden;
      }
      .progressbar > div {
        height: 100%;
        width: 0;
        background: #328714;
        transition: 0.25s;
      }

      .stepmeta {
        font-size: 12px;
        color: var(--muted);
        font-weight: 800;
      }

      .steps {
        margin-top: 10px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .chip {
        border: 1px solid #d6d6da;
        background: #fafafa;
        color: #222;
        font-weight: 800;
        padding: 7px 10px;
        border-radius: 999px;
        font-size: 12px;
        cursor: pointer;
        user-select: none;
      }
      .chip.active {
        background: var(--primary);
        border-color: var(--primary);
        color: #fff;
      }
      .chip.done {
        border-color: #86b186;
        background: #eaf7ea;
      }
      .chip.blocked {
        border-color: #e3b0b8;
        background: #fff3f5;
      }

      form {
        margin-top: 12px;
        overflow: hidden;
      }

      .section-title {
        background: var(--primary);
        color: #fff;
        font-weight: 900;
        padding: 10px 14px;
        font-size: 14px;
        letter-spacing: 0.4px;
        text-transform: uppercase;
      }

      .grid {
        padding: 12px 14px 16px;
        border-top: 1px solid var(--border);
      }

      .row {
        display: grid;
        grid-template-columns: 260px 1fr;
        gap: 10px;
        align-items: center;
        margin: 7px 0;
      }
      .row.compact {
        grid-template-columns: 260px 1fr 1fr;
      }

      label {
        color: var(--label);
        font-size: 13px;
        font-weight: 800;
      }
      .req {
        color: var(--danger);
        font-weight: 900;
        margin-left: 4px;
      }

      input[type='text'],
      input[type='email'],
      input[type='tel'],
      select,
      textarea {
        width: 100%;
        padding: 9px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 13px;
        background: #fff;
        outline: none;
      }

      input.invalid,
      select.invalid,
      textarea.invalid {
        border-color: #fbe058;
        box-shadow: 0 0 0 2px #fbe058;
      }
      input.valid,
      select.valid,
      textarea.valid {
        border-color: #7bbf7b;
        box-shadow: 0 0 0 3px rgba(83, 164, 83, 0.1);
      }

      textarea {
        min-height: 80px;
        resize: vertical;
      }

      .hint,
      .warn,
      .warn2,
      .field-error {
        grid-column: 2/-1;
        font-size: 12px;
        font-weight: 900;
        margin-top: -5px;
        margin-bottom: 5px;
      }
      .hint {
        color: var(--muted);
        margin-top: -2px;
      }
      .warn {
        color: var(--danger);
      }
      .field-error {
        color: #000;
        display: none;
      }

      .two-col {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
      }

      .panel {
        border: 1px solid var(--border);
        border-radius: 8px;
        background: #fff;
        overflow: hidden;
      }
      .panel .panel-h {
        background: #3a3a3a;
        color: #fff;
        font-weight: 900;
        padding: 8px 10px;
        font-size: 13px;
        text-transform: uppercase;
      }
      .panel .panel-sub {
        padding: 8px 10px 0;
        color: #2b2b2b;
        font-size: 12px;
        font-weight: 900;
      }
      .panel .panel-b {
        padding: 10px;
      }

      .mini {
        display: grid;
        grid-template-columns: 1fr 110px;
        gap: 10px;
      }
      .mini-2 {
        display: grid;
        gap: 10px;
      }
      .mini-3 {
        display: grid;
        grid-template-columns: 110px 1fr;
        gap: 10px;
      }

      .radio-line,
      .check-line {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }
      .radio-line label,
      .check-line label {
        font-weight: 900;
      }
      .radio-line input,
      .check-line input {
        transform: translateY(1px);
      }

      .divider {
        height: 1px;
        background: var(--border);
        margin: 10px 0;
      }

      .step {
        display: none;
      }
      .step.active {
        display: block;
      }

      .footerbar {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        padding: 12px 14px;
        border-top: 1px solid var(--border);
        background: #fafafa;
        align-items: center;
        flex-wrap: wrap;
      }
      .status {
        font-size: 12px;
        color: var(--muted);
        font-weight: 900;
      }
      .border {
        margin-top: 15px;
        margin-bottom: 15px;
        border-top: 1px solid var(--border);
      }
      pre {
        margin: 12px 14px 16px;
        background: #0b0b0b;
        color: #eaeaea;
        padding: 14px;
        border-radius: 10px;
        overflow: auto;
        border: 1px solid #1e1e1e;
      }

      .errorbox {
        display: none;
        margin: 10px 14px 10px;
        padding: 10px 12px;
        border: 1px solid #fbe058;
        border-radius: 10px;
        color: #000;
        background: #fbe058;
        font-size: 12px;
        font-weight: 900;
      }

      @media print {
        body {
          background: #fff !important;
        }
        .topbar,
        .progress-wrap,
        .footer,
        .actions {
          display: none !important;
        }
        .wrap {
          max-width: 100% !important;
          padding: 0 !important;
        }
        form {
          box-shadow: none !important;
          border-radius: 0 !important;
        }
        .section {
          page-break-inside: avoid;
        }
        h3 {
          color: #000 !important;
        }
      }

      @media (max-width: 980px) {
        .row,
        .row.compact,
        .two-col,
        .mini {
          grid-template-columns: 1fr;
        }
        .right-actions {
          justify-content: flex-start;
        }
        .topbar {
          flex-direction: column;
          align-items: flex-start;
        }
        .apptitle {
          display: flex;
          align-items: flex-start !important;
        }
      }

      .hidden {
        display: none;
      }
      .apptitle {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .pdfbutton {
        background: #9e0000;
        border-color: #9e0000;
      }

      .text-sm {
        font-size: 12px;
      }

      .text-xsm {
        font-size: 12px;
      }
      .text-bold {
        font-weight: 900;
      }

      .flex {
        display: flex;
      }
      .flex-row {
        flex-direction: row;
      }
      .flex-col {
        flex-direction: column;
      }
      .justify-center {
        justify-content: center;
      }
      .items-center {
        align-items: center;
      }
      .items-left {
        align-items: flex-start;
      }
      .mt-4 {
        margin-top: 30px;
      }
      .mt-1 {
        margin-top: 3px;
      }
      .ml-4 {
        margin-left: 20px;
      }
      .-ml-2 {
        margin-left: -15px;
      }
      .gap-4 {
        gap: 20px;
      }
      .gap-10 {
        gap: 50px;
      }

      input[type='radio'],
      input[type='checkbox'] {
        accent-color: var(--primary);
      }
      input[type='checkbox'].success {
        accent-color: #16a34a;
      }
      input[type='checkbox'].warning {
        accent-color: #f59e0b;
      }
      input[type='radio'].danger {
        accent-color: #dc2626;
      }

      .secondary-text {
        color: #3b3b3b;
      }

      .flex-width {
        width: 50%;
      }

      .no-break {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .flex-m {
        display: flex;
        flex-direction: row; /* default */
      }
      .text-ssm {
        font-size: 9px;
        margin-top: 2px;
      }
      .label-sm {
        font-size: 10px;
        margin-top: 2px;
      }
      @media (max-width: 640px) {
        .flex-m {
          flex-direction: column; /* mobile */
        }
        .flex-width {
          width: 100%;
        }
        .gap-10 {
          gap: 10px;
        }
      }
      .modal.is-open {
        transform: translateY(0);
        opacity: 1;
      }

      ul {
        margin-left: -20px;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 6px 0;
      }
      .ident-input-block {
        margin: 8px 0 14px 0;
      }
      .ident-input-block label {
        display: block;
        font-size: 0.9rem;
        margin-bottom: 6px;
      }
      .ident-input-block input[type='text'] {
        width: 100%;
        max-width: 520px;
        padding: 8px 10px;
        border: 1px solid #c9c9c9;
        border-radius: 4px;
      }
      .field-error {
        color: #b3261e; /* error red */
        font-size: 0.9rem;
        margin-top: 6px;
      }
      .sr-only {
        /* visually hidden but accessible to screen readers */
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div
        id="backdrop"
        class="modal-backdrop"
        aria-hidden="true"
        style="display: none"
      >
        <div
          id="modal"
          class="modal"
          role="dialog"
          aria-modal="true"
          aria-labelledby="modal-title"
          aria-describedby="modal-desc"
          tabindex="-1"
        >
          <div class="modal-header">
            <h2 id="modal-title" class="modal-title">Tax Exempt</h2>
          </div>

          <div class="modal-body">
            <p id="modal-desc">
              Please attach your <b>Tax Exempt Certificate</b> while sending
              your form. Ship to facility name and address must appear on Tax
              Exempt Cerfiticate.
            </p>
          </div>

          <div class="modal-footer">
            <button class="btn btn-close" type="button" id="closeModal">
              Continue
            </button>
          </div>
        </div>
      </div>
      <div class="topbar">
        <div class="brand">
          <img
            src="https://raw.githubusercontent.com/mdm-ops/mdm-ops.smartform.external/refs/heads/main/Johnson-And-Johnson-Logo-PNG-Background.png"
            width="160"
            height="50"
          />
        </div>

        <div class="apptitle">
          <span class="text-bold">Name TBD</span>
          <span class="text-sm secondary-text"
            >Thank you for contacting Johnson & Johnson MedTech.
          </span>
          <span class="text-sm secondary-text">
            For any questions on this request, please contact support team
            <a href="mailto:mdm-ops@its.jnj.com">support@its.jnj.com</a>
          </span>
        </div>

        <div class="right-actions">
          <button
            class="btn small ghost hidden"
            type="button"
            id="btnExportJSON"
          >
            Export JSON
          </button>

          <button class="btn small pdfbutton" type="button" id="btnPrint">
            Print PDF
          </button>
          <button class="btn small secondary" type="button" id="btnExportCSV">
            Download CSV
          </button>
        </div>
      </div>

      <div class="progress-wrap">
        <div class="progress-row">
          <div class="stepmeta">Live Progress</div>
          <div class="progressbar" aria-label="progress">
            <div id="bar"></div>
          </div>

          <div class="stepmeta" id="stepMeta">Step 1 of 3</div>
        </div>

        <div class="steps" id="stepChips"></div>
      </div>

      <form id="form" novalidate>
        <div class="errorbox" id="errors"></div>

        <!-- STEP 1 -->

        <div class="step active" data-step="0">
          <div class="section-title">Section A: Contact Information</div>

          <div class="grid">
            <div class="row">
              <label for="fullName"
                >Full Name (First & Last) <span class="req">*</span></label
              >

              <input
                id="fullName"
                name="fullName"
                type="text"
                data-label="Full Name (First & Last)"
                data-required="true"
                placeholder="Your Firstname and Lastname"
              />

              <div class="field-error" data-for="fullName"></div>
            </div>

            <div class="row compact">
              <div class="flex flex-col">
                <label for="businessEmailAddress"
                  >Business Email Address <span class="req">*</span></label
                >
                <span class="text-sm secondary-text">
                  (We’ll send your confirmation here)</span
                >
              </div>

              <input
                id="businessEmailAddress"
                name="businessEmailAddress"
                type="email"
                data-label="Business Email Address"
                data-required="true"
                placeholder="Business Email Address"
                data-type="email"
              />

              <div class="mini-2">
                <input
                  id="businessContactNumber"
                  name="businessContactNumber"
                  type="text"
                  data-required="false"
                  data-label="Contact Number"
                  placeholder="Business Contact Number"
                />
              </div>
              <div class="field-error" data-for="businessEmailAddress"></div>
              <div class="field-error" data-for="businessContactNumber"></div>
            </div>
          </div>
          <div class="section-title">Section B: Facility Details</div>

          <div class="grid">
            <div class="row compact">
              <label for="companyName"
                >Facility Name <span class="req">*</span></label
              >

              <input
                id="companyName"
                name="companyName"
                type="text"
                data-required="true"
                placeholder="Facility Name"
                data-label="Facility Name"
              />

              <div class="mini-2">
                <input
                  id="website"
                  name="website"
                  type="text"
                  placeholder="Facility Website URL: Eg. https://home.jnj.com"
                  data-label="Website"
                />
              </div>
              <div class="field-error" data-for="companyName"></div>
              <div class="field-error" data-for="website"></div>
            </div>

            <div class="row compact">
              <label for="facilityType"
                >Facility Type <span class="req">*</span></label
              >

              <select
                id="facilityType"
                name="facilityType"
                data-label="Facility Type"
                data-required="true"
              >
                <option value="">Select Facility Type</option>
                <option value="Hospital">Hospital</option>
                <option value="Pharmacies">Pharmacies</option>
                <option value="Ambulatory Surgery Center">
                  Ambulatory Surgery Center
                </option>
                <option value="Veterinary">Veterinary</option>
                <option value="Physician Account">Physician Account</option>
                <option value="Other">Other</option>
                <option value="Long Term Care">Long Term Care</option>
              </select>
              <input
                id="input_facility_type"
                name="facilityType"
                type="text"
                placeholder="Please specify facility type."
                data-label="Other Facility Type"
              />
              <div class="mini-2">
                <div class="jnj-text text-sm" id="facility_section"></div>
              </div>
              <div class="field-error" data-for="facilityType"></div>
            </div>

            <div class="row" id="identification-row">
              <label for="identGroup">Identification Number</label>

              <div
                style="
                  display: grid;
                  grid-template-columns: 220px 1fr;
                  gap: 10px;
                "
              >
                <!-- Left column: checkbox group (multi-select) -->
                <div
                  id="identTypeGroup"
                  role="group"
                  aria-labelledby="identGroupLabel"
                >
                  <div id="identGroupLabel" class="sr-only">
                    Select one or more Identification Types
                  </div>

                  <!-- Checkboxes will be injected here by JS -->
                  <!-- Example structure:
      <label class="checkbox-item">
        <input type="checkbox" name="identType[]" value="NPI" data-label="National Provider Identifier">
        National Provider Identifier
      </label>
      -->
                </div>

                <!-- Right column: dynamic inputs appear here -->
                <div id="identInputs"></div>
              </div>

              <div class="field-error" data-for="identType"></div>
              <div class="field-error" data-for="identNumber"></div>
            </div>
          </div>

          <div class="section-title">Section C: TBD</div>
          <div class="grid">
            <div class="row">
              <label>Is your Ship-To facility “Tax Exempt”?</label>

              <div class="radio-line">
                <label
                  ><input
                    type="radio"
                    id="isTaxExempt"
                    name="taxExempt"
                    value="Yes"
                  />
                  Yes</label
                >

                <label
                  ><input
                    type="radio"
                    id="isNotTaxExempt"
                    name="taxExempt"
                    value="No"
                    checked
                  />
                  No</label
                >
                <div
                  id="taxExemptNote"
                  style="display: none"
                  class="text-sm mt-1 ml-4 jnj-text"
                >
                  ❗Please attach your Tax Exempt Certificate in your email
                  attachment.
                </div>
              </div>
            </div>

            <div class="row">
              <label>Is your Organization</label>

              <div class="radio-line">
                <label
                  ><input
                    type="radio"
                    name="orgType"
                    value="For Profit"
                    checked
                  />
                  For Profit</label
                >

                <label
                  ><input type="radio" name="orgType" value="Non Profit" /> Non
                  Profit</label
                >
              </div>
            </div>
            <div class="row">
              <label>Do you have On-site Diagnostics Services?</label>

              <div class="radio-line">
                <label
                  ><input type="radio" name="diagSvc" value="Yes" /> Yes</label
                >

                <label
                  ><input type="radio" name="diagSvc" value="No" checked />
                  No</label
                >
              </div>
            </div>

            <div class="row">
              <label for="productsInterested"
                >What Products are you interested in?</label
              >

              <input
                id="productsInterested"
                name="productsInterested"
                type="text"
                data-label="Products Interested"
              />

              <div class="field-error" data-for="productsInterested"></div>
            </div>

            <div class="row">
              <label
                >Will you be interested in Ethicon Biological Products?</label
              >

              <div class="radio-line">
                <label
                  ><input type="radio" name="ethiconBio" value="Yes" />
                  Yes</label
                >

                <label
                  ><input type="radio" name="ethiconBio" value="No" checked />
                  No</label
                >
              </div>
            </div>

            <div
              id="bioBlock"
              style="
                display: none;
                border: 1px dashed var(--border);
                padding: 10px;
                border-radius: 10px;
              "
            >
              <div class="row">
                <label for="pharmacyLicense">Pharmacy License Number</label>

                <input
                  id="pharmacyLicense"
                  name="pharmacyLicense"
                  type="text"
                  data-label="Pharmacy License Number"
                />

                <div class="field-error" data-for="pharmacyLicense"></div>
              </div>

              <div class="row">
                <label for="bioProducts"
                  >Biological product names you are interested in</label
                >

                <input
                  id="bioProducts"
                  name="bioProducts"
                  type="text"
                  data-label="Biological Products"
                />

                <div class="field-error" data-for="bioProducts"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 2 -->

        <div class="step" data-step="1">
          <div class="section-title">
            Section D: Structure Creation (Ship-To / Bill-To / Pay-From)
          </div>

          <div class="grid">
            <div class="hidden">
              <label
                >Ship-To Address Information (Where product will be
                shipped)</label
              >
            </div>

            <div class="panel" style="margin-top: 6px">
              <div class="panel-h">
                Ship-To Address (Where product will be shipped)
              </div>

              <div class="panel-sub">
                <label class="check-line" style="font-weight: 900">
                  Bill-To and Pay-From can be copied automatically from Ship-To.
                </label>
              </div>

              <div class="panel-b">
                <div class="row">
                  <label for="shipFacilityName"
                    >Facility Name<span class="req">*</span></label
                  >

                  <input
                    id="shipFacilityName"
                    name="shipFacilityName"
                    type="text"
                    data-required="true"
                    data-label="Facility Name"
                  />

                  <div class="field-error" data-for="shipFacilityName"></div>
                </div>

                <div class="row compact">
                  <label for="shipAddr1"
                    >Address Line 1 <span class="req">*</span></label
                  >

                  <input
                    id="shipAddr1"
                    name="shipAddr1"
                    type="text"
                    data-required="true"
                    data-label="Ship-To Address Line 1"
                  />

                  <div class="mini-3">
                    <select
                      id="shipAddrType1"
                      name="shipAddrType1"
                      data-label="Address Type"
                      data-required="true"
                    >
                      <option value="">Choose</option>
                      <option value="Apt">Apt</option>
                      <option value="Suite">Suite</option>
                      <option value="Others">Others</option>
                    </select>

                    <input
                      id="shipAddrTypeValue1"
                      name="shipAddrTypeValue1"
                      type="text"
                      placeholder="Apt/Suite/Other"
                      data-label="Address Type Value"
                      data-required="true"
                    />
                  </div>

                  <div class="field-error" data-for="shipAddr1"></div>
                  <div class="field-error" data-for="shipAddrType1"></div>
                  <div class="field-error" data-for="shipAddrTypeValue1"></div>
                </div>

                <div class="row compact">
                  <label for="shipAddr2">Address Line 2</label>

                  <input
                    id="shipAddr2"
                    name="shipAddr2"
                    type="text"
                    data-required="false"
                    data-label="Ship-To Address Line 2"
                  />

                  <div class="mini-3">
                    <select
                      id="shipAddrType2"
                      name="shipAddrType2"
                      data-label="Address Type"
                      data-required="false"
                    >
                      <option value="">Choose</option>
                      <option value="Apt">Apt</option>
                      <option value="Suite">Suite</option>
                      <option value="Others">Others</option>
                    </select>

                    <input
                      id="shipAddrTypeValue2"
                      name="shipAddrTypeValue2"
                      type="text"
                      placeholder="Apt/Suite/Other"
                      data-label="Address Type Value"
                      data-required="false"
                    />
                  </div>

                  <div class="field-error" data-for="shipAddr2"></div>
                  <div class="field-error" data-for="shipAddrType2"></div>
                  <div class="field-error" data-for="shipAddrTypeValue2"></div>
                </div>
                <div class="row">
                  <label for="shipPOBoxNumber"
                    >PO Box Number (if applicable)</label
                  >

                  <input
                    id="shipPOBoxNumber"
                    name="shipPOBoxNumber"
                    type="text"
                    data-required="false"
                    data-label="PO Box Number"
                    placeholder="Enter PO #"
                  />

                  <div class="field-error" data-for="shipPOBoxNumber"></div>
                </div>

                <div class="row compact">
                  <label for="shipCity">City <span class="req">*</span></label>

                  <input
                    id="shipCity"
                    name="shipCity"
                    type="text"
                    data-required="true"
                    data-label="Ship-To City"
                  />

                  <div class="mini">
                    <select
                      id="shipState"
                      name="shipState"
                      data-label="Ship-To State"
                      data-type="state2"
                      data-required="true"
                    >
                      <option value="">Select State</option>
                      <option value="AL">Alabama</option>
                      <option value="AK">Alaska</option>
                      <option value="AZ">Arizona</option>
                      <option value="AR">Arkansas</option>
                      <option value="CA">California</option>
                      <option value="CO">Colorado</option>
                      <option value="CT">Connecticut</option>
                      <option value="DE">Delaware</option>
                      <option value="FL">Florida</option>
                      <option value="GA">Georgia</option>
                      <option value="HI">Hawaii</option>
                      <option value="ID">Idaho</option>
                      <option value="IL">Illinois</option>
                      <option value="IN">Indiana</option>
                      <option value="IA">Iowa</option>
                      <option value="KS">Kansas</option>
                      <option value="KY">Kentucky</option>
                      <option value="LA">Louisiana</option>
                      <option value="ME">Maine</option>
                      <option value="MD">Maryland</option>
                      <option value="MA">Massachusetts</option>
                      <option value="MI">Michigan</option>
                      <option value="MN">Minnesota</option>
                      <option value="MS">Mississippi</option>
                      <option value="MO">Missouri</option>
                      <option value="MT">Montana</option>
                      <option value="NE">Nebraska</option>
                      <option value="NV">Nevada</option>
                      <option value="NH">New Hampshire</option>
                      <option value="NJ">New Jersey</option>
                      <option value="NM">New Mexico</option>
                      <option value="NY">New York</option>
                      <option value="NC">North Carolina</option>
                      <option value="ND">North Dakota</option>
                      <option value="OH">Ohio</option>
                      <option value="OK">Oklahoma</option>
                      <option value="OR">Oregon</option>
                      <option value="PA">Pennsylvania</option>
                      <option value="RI">Rhode Island</option>
                      <option value="SC">South Carolina</option>
                      <option value="SD">South Dakota</option>
                      <option value="TN">Tennessee</option>
                      <option value="TX">Texas</option>
                      <option value="UT">Utah</option>
                      <option value="VT">Vermont</option>
                      <option value="VA">Virginia</option>
                      <option value="WA">Washington</option>
                      <option value="WV">West Virginia</option>
                      <option value="WI">Wisconsin</option>
                      <option value="WY">Wyoming</option>
                    </select>

                    <input
                      id="shipPostal"
                      name="shipPostal"
                      type="text"
                      placeholder="Postal Code"
                      data-label="Ship-To Postal Code"
                      data-type="postal"
                      data-required="true"
                    />
                  </div>

                  <div class="field-error" data-for="shipCity"></div>
                  <div class="field-error" data-for="shipState"></div>
                  <div class="field-error" data-for="shipPostal"></div>
                </div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="two-col">
              <div class="panel">
                <div class="panel-h">
                  Bill-To Information (Where invoices will be sent)
                </div>

                <div class="panel-sub">
                  <label class="check-line" style="font-weight: 900">
                    <input type="checkbox" id="billSameAsShip" checked />

                    Check this box if Bill-To Address is same as above current
                    Ship-To address
                  </label>
                </div>

                <div class="panel-b">
                  <div class="row">
                    <label for="billFacilityName">Facility Name</label>

                    <input
                      id="billFacilityName"
                      name="billFacilityName"
                      type="text"
                      data-label="Facility Name"
                    />

                    <div class="field-error" data-for="billFacilityName"></div>
                  </div>

                  <div class="row">
                    <label for="billAddr1">Address Line 1</label>

                    <input
                      id="billAddr1"
                      name="billAddr1"
                      type="text"
                      data-label="Bill-To Address Line 1"
                    />

                    <div class="field-error" data-for="billAddr1"></div>
                  </div>
                  <div class="row compact">
                    <label for="billAddrType1"></label>

                    <select
                      id="billAddrType1"
                      name="billAddrType1"
                      data-label="Apt/Suite/Others"
                    >
                      <option value="">Choose</option>
                      <option value="Apt">Apt</option>
                      <option value="Suite">Suite</option>
                      <option value="Others">Others</option>
                    </select>
                    <input
                      id="billAddrTypeValue1"
                      name="billAddrTypeValue1"
                      type="text"
                      placeholder="Apt/Suite/Others"
                      data-label="Type"
                    />
                    <div class="field-error" data-for="billAddr1"></div>
                    <div class="field-error" data-for="billAddrType"></div>
                    <div
                      class="field-error"
                      data-for="billAddrTypeValue1"
                    ></div>
                  </div>

                  <div class="row">
                    <label for="billPOBoxNumber">PO Box Number</label>

                    <input
                      id="billPOBoxNumber"
                      name="billPOBoxNumber"
                      type="text"
                      placeholder="Enter PO #"
                      data-label="PO Box Number"
                    />

                    <div class="field-error" data-for="billPOBoxNumber"></div>
                  </div>

                  <div class="row compact">
                    <label for="billCity">City</label>
                    <input
                      id="billCity"
                      name="billCity"
                      type="text"
                      data-label="Bill-To City"
                    />
                    <div class="field-error" data-for="billCity"></div>

                    <select
                      id="billState"
                      name="billState"
                      data-label="Bill-To State"
                      data-type="state2"
                    >
                      <option value="">Select State</option>
                      <option value="AL">Alabama</option>
                      <option value="AK">Alaska</option>
                      <option value="AZ">Arizona</option>
                      <option value="AR">Arkansas</option>
                      <option value="CA">California</option>
                      <option value="CO">Colorado</option>
                      <option value="CT">Connecticut</option>
                      <option value="DE">Delaware</option>
                      <option value="FL">Florida</option>
                      <option value="GA">Georgia</option>
                      <option value="HI">Hawaii</option>
                      <option value="ID">Idaho</option>
                      <option value="IL">Illinois</option>
                      <option value="IN">Indiana</option>
                      <option value="IA">Iowa</option>
                      <option value="KS">Kansas</option>
                      <option value="KY">Kentucky</option>
                      <option value="LA">Louisiana</option>
                      <option value="ME">Maine</option>
                      <option value="MD">Maryland</option>
                      <option value="MA">Massachusetts</option>
                      <option value="MI">Michigan</option>
                      <option value="MN">Minnesota</option>
                      <option value="MS">Mississippi</option>
                      <option value="MO">Missouri</option>
                      <option value="MT">Montana</option>
                      <option value="NE">Nebraska</option>
                      <option value="NV">Nevada</option>
                      <option value="NH">New Hampshire</option>
                      <option value="NJ">New Jersey</option>
                      <option value="NM">New Mexico</option>
                      <option value="NY">New York</option>
                      <option value="NC">North Carolina</option>
                      <option value="ND">North Dakota</option>
                      <option value="OH">Ohio</option>
                      <option value="OK">Oklahoma</option>
                      <option value="OR">Oregon</option>
                      <option value="PA">Pennsylvania</option>
                      <option value="RI">Rhode Island</option>
                      <option value="SC">South Carolina</option>
                      <option value="SD">South Dakota</option>
                      <option value="TN">Tennessee</option>
                      <option value="TX">Texas</option>
                      <option value="UT">Utah</option>
                      <option value="VT">Vermont</option>
                      <option value="VA">Virginia</option>
                      <option value="WA">Washington</option>
                      <option value="WV">West Virginia</option>
                      <option value="WI">Wisconsin</option>
                      <option value="WY">Wyoming</option>
                    </select>
                  </div>

                  <div class="row">
                    <label for="billPostal">Postal Code</label>
                    <input
                      id="billPostal"
                      name="billPostal"
                      type="text"
                      data-label="Bill-To Postal"
                    />
                    <div class="field-error" data-for="billPostal"></div>
                  </div>
                </div>
              </div>

              <div class="panel">
                <div class="panel-h">
                  Pay-From Information (From where invoices will be paid)
                </div>

                <div class="panel-sub">
                  <div class="radio-line">
                    <span style="font-weight: 900"
                      >Select one if Pay-From Address is same as…</span
                    >

                    <label
                      ><input
                        type="radio"
                        name="payFromMode"
                        value="ship"
                        checked
                      />
                      Ship-To Address</label
                    >

                    <label
                      ><input type="radio" name="payFromMode" value="bill" />
                      Bill-To Address</label
                    >
                  </div>
                </div>

                <div class="panel-b">
                  <div class="row">
                    <div class="flex flex-col">
                      <label for="payFacilityName">Facility Name</label>
                      <label class="label-sm">(Doing Business As)</label>
                    </div>

                    <input
                      id="payFacilityName"
                      name="payFacilityName"
                      type="text"
                      data-label="Facility Name"
                    />

                    <div class="field-error" data-for="payFacilityName"></div>
                  </div>

                  <div class="row">
                    <label for="payAddr1">Address Line 1</label>

                    <input
                      id="payAddr1"
                      name="payAddr1"
                      type="text"
                      data-label="Pay-From Address Line 1"
                    />

                    <div class="field-error" data-for="payAddr1"></div>
                  </div>
                  <div class="row compact">
                    <label for="payAddrType1"></label>

                    <select
                      id="payAddrType1"
                      name="payAddrType1"
                      data-label="Apt/Suite/Others"
                    >
                      <option value="">Choose</option>
                      <option value="Apt">Apt</option>
                      <option value="Suite">Suite</option>
                      <option value="Others">Others</option>
                    </select>
                    <input
                      id="payAddrTypeValue1"
                      name="payAddrTypeValue1"
                      type="text"
                      placeholder="Apt/Suite/Others"
                      data-label="Type"
                    />
                    <div class="field-error" data-for="payAddr1"></div>
                    <div class="field-error" data-for="payAddrType"></div>
                    <div class="field-error" data-for="payAddrTypeValue1"></div>
                  </div>

                  <div class="row">
                    <label for="payPOBoxNumber">PO Box Number</label>

                    <input
                      id="payPOBoxNumber"
                      name="payPOBoxNumber"
                      type="text"
                      placeholder="Enter PO #"
                      data-label="PO Box Number"
                    />

                    <div class="field-error" data-for="payPOBoxNumber"></div>
                  </div>

                  <div class="row compact">
                    <label for="payCity">City</label>
                    <input
                      id="payCity"
                      name="payCity"
                      type="text"
                      data-label="Pay-To City"
                    />
                    <input
                      id="payState"
                      name="payState"
                      type="text"
                      placeholder="State"
                      maxlength="2"
                      data-label="pay-To State"
                      data-type="state2"
                    />
                    <div class="field-error" data-for="payCity"></div>
                  </div>

                  <div class="row">
                    <label for="payPostal">Postal Code</label>
                    <input
                      id="payPostal"
                      name="payPostal"
                      type="text"
                      data-label="Pay-To Postal"
                    />
                    <div class="field-error" data-for="payPostal"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 3 -->

        <div class="step" data-step="2">
          <div class="section-title">
            Section E: Accounts Payable Contact Information
          </div>

          <div class="grid">
            <div class="hint">
              (If you do not have Accounts Payable department then provide
              Purchasing/office manager contact)
            </div>

            <div class="row">
              <label for="apBusinessContactName">Business Contact</label>

              <input
                id="apBusinessContactName"
                name="apBusinessContactName"
                type="text"
                data-label="Business Contact Name"
              />
              <div class="field-error" data-for="apBusinessContactName"></div>
            </div>
            <div class="row">
              <label for="legalTypeOfCompany">Legal Type of Company</label>
              <select
                id="legalTypeOfCompany"
                name="legalTypeOfCompany"
                data-label="Legal Type of Company"
                data-type="legx"
              >
                <option value="Corporation Partnership" selected>
                  Corporation Partnership
                </option>
                <option value="Sole Proprietorship">Sole Proprietorship</option>
              </select>
              <div class="field-error" data-for="legalTypeOfCompany"></div>
            </div>

            <div class="row compact">
              <label for="apBusinessEmail"
                >Email Address <span class="req">*</span></label
              >

              <input
                id="apBusinessEmail"
                name="apBusinessEmail"
                type="email"
                data-required="true"
                data-label="Business Email"
                data-type="email"
                placeholder="Business email address (personal email IDs will not be accepted)."
              />
              <div class="mini-2">
                <input
                  id="apBusinessContactNumber"
                  name="apBusinessContactNumber"
                  type="text"
                  data-required="false"
                  data-label="Contact Number"
                  placeholder="Business Contact Number"
                />
              </div>

              <div class="field-error" data-for="apBusinessEmail"></div>
              <!-- <div class="warn2">Please provide your business email ID (personal email IDs will not be accepted).</div> -->
            </div>
            <!-- 
            <div class="row">
              <label for="apBestTime">Best Time To Call</label>

              <input
                id="apBestTime"
                name="apBestTime"
                type="text"
                data-label="AP Best Time To Call"
                placeholder="e.g., 9am - 11am EST"
              />
              <div class="warn2">
                In case JNJ needs more information or requires any additional
                validation.
              </div>
              <div class="field-error" data-for="apBestTime"></div>
            </div> -->
          </div>

          <div class="section-title">Section F: Additional Information</div>

          <div class="grid">
            <div class="row">
              <label for="salesRep">J&amp;J Sales Rep Name</label>

              <input
                id="salesRep"
                name="salesRep"
                type="text"
                data-label="J&J Sales Rep"
              />

              <div class="field-error" data-for="salesRep"></div>
            </div>
            <div class="row">
              <label for="salesRep">J&amp;J Contact Number</label>

              <input
                id="salesRepNumber"
                name="salesRepNumber"
                type="text"
                data-label="Contact Number"
              />

              <div class="field-error" data-for="salesRepNumber"></div>
            </div>
          </div>
        </div>

        <div class="footerbar">
          <div class="flex flex-col">
            <div class="status" id="status">Ready.</div>
          </div>

          <div style="display: flex; gap: 10px; flex-wrap: wrap">
            <button class="btn small ghost" type="button" id="btnReset">
              <div class="flex flex-col justify-center">
                <img
                  src="https://raw.githubusercontent.com/mdm-ops/mdm-ops.smartform.external/refs/heads/main/JJ_Icon_Permanent_Delete_RGB.svg"
                  height="17px"
                  width="21px"
                />
                <div class="text-ssm">Reset</div>
              </div>
            </button>
            <button class="btn small ghost" type="button" id="btnSaveDraft">
              <div class="flex flex-col justify-center">
                <img
                  src="https://raw.githubusercontent.com/mdm-ops/mdm-ops.smartform.external/refs/heads/main/JJ_Icon_Save_RGB.svg"
                  height="17px"
                  width="21px"
                />
                <div class="text-ssm">Save</div>
              </div>
            </button>

            <button class="btn small ghost" type="button" id="btnLoadDraft">
              <div class="flex flex-col justify-center">
                <img
                  src="https://raw.githubusercontent.com/mdm-ops/mdm-ops.smartform.external/refs/heads/main/JJ_Icon_Refresh_Sync_RGB.svg"
                  height="17px"
                  width="21px"
                />
                <div class="text-ssm">Load</div>
              </div>
            </button>

            <button type="button" class="btn ghost" id="btnPrev">Prev</button>

            <button type="button" class="btn" id="btnNext">Next</button>

            <button type="button" class="btn secondary" id="btnSubmit">
              Submit
            </button>
          </div>
        </div>
      </form>
      <div class="progress-wrap">
        <div class="progress-row text-xsm">
          <ul>
            <div class="disclaimer-header -ml-2" id="footer-helper">
              Disclaimer: All information provided is subject to verification.
              Incomplete information may require follow-up.
            </div>
            <li>
              If your information is incomplete, Johnson &amp; Johnson will send
              an email requesting information.
              <ul>
                <li>
                  You must provide the requested information within 2 Business
                  Days.
                </li>
                <li>
                  Upon request approval, you will be allowed to order products
                  directly from J&amp;J and not through Distributors.
                </li>
              </ul>
            </li>

            <li>
              If you are unable to provide the complete information, your
              application will be rejected.
            </li>

            <li>
              We retain your contact information including phone number,
              address, and email address for account setup validation and
              responding to inquiries, such as sending/receiving documents or
              direct email alerts.
              <ul>
                <li>
                  You may request that we modify/delete any information
                  collected about you by calling our Customer Service number at
                  <strong>1‑800‑255‑2500</strong>.
                </li>
              </ul>
            </li>
          </ul>
        </div>

        <div class="steps" id="stepChips"></div>
      </div>
    </div>

    <script>
      ;(() => {
        const $ = id => document.getElementById(id)

        const form = $('form')

        const steps = Array.from(document.querySelectorAll('.step'))

        const bar = $('bar')

        const stepMeta = $('stepMeta')

        const chipsWrap = $('stepChips')

        const errorsBox = $('errors')

        const statusEl = $('status')

        const outputEl = $('output')

        const DRAFT_KEY = 'jnj_form_clone_smart_draft_v1'

        const modal = document.getElementById('backdrop')

        let lastFocusedElement = null

        // ---------- Step Model ----------

        const stepDefs = [
          { title: 'General Information', stepIndex: 0 },

          { title: 'Shipping & Billing', stepIndex: 1 },

          { title: 'Accounts Payable', stepIndex: 2 }
        ]

        let currentStep = 0

        document
          .getElementById('isTaxExempt')
          .addEventListener('change', function () {
            if (this.checked) {
              openModal()
              document.getElementById('taxExemptNote').style.display = 'block'
            }
          })
        document
          .getElementById('isNotTaxExempt')
          .addEventListener('change', function () {
            if (this.checked) {
              document.getElementById('taxExemptNote').style.display = 'none'
            }
          })

        document
          .getElementById('closeModal')
          .addEventListener('click', function () {
            closeModal()
          })

        function setStatus(msg) {
          statusEl.textContent = msg
        }

        function renderChips() {
          chipsWrap.innerHTML = ''

          stepDefs.forEach((s, i) => {
            const chip = document.createElement('div')

            chip.className = 'chip'

            chip.textContent = `${i + 1}. ${s.title}`

            chip.addEventListener('click', () =>
              gotoStep(i, { allowForwardIfValid: true })
            )

            chip.dataset.step = String(i)

            chipsWrap.appendChild(chip)
          })
        }

        function getFocusableElements(container) {
          // Focusable selectors per WAI-ARIA authoring practices
          const selectors = [
            'a[href]',
            'area[href]',
            'input:not([disabled]):not([type="hidden"])',
            'select:not([disabled])',
            'textarea:not([disabled])',
            'button:not([disabled])',
            'iframe',
            'audio[controls]',
            'video[controls]',
            '[contenteditable]:not([contenteditable="false"])',
            '[tabindex]:not([tabindex="-1"])'
          ]
          return [...container.querySelectorAll(selectors.join(','))].filter(
            el => el.offsetParent !== null || el === document.activeElement
          )
        }

        function openModal() {
          lastFocusedElement = document.activeElement
          modal.style.display = 'block' // show
          modal.classList.add('is-open')

          // Move focus inside the modal
          modal.setAttribute('aria-hidden', 'false')
          const focusables = getFocusableElements(modal)
          ;(focusables[0] || modal).focus()

          // Prevent background scroll (optional)
          document.body.style.overflow = 'hidden'
        }

        function closeModal() {
          modal.style.display = 'none' // hide
          modal.classList.remove('is-open')
          modal.setAttribute('aria-hidden', 'true')

          // Restore focus
          if (
            lastFocusedElement &&
            typeof lastFocusedElement.focus === 'function'
          ) {
            lastFocusedElement.focus()
          }
          document.body.style.overflow = ''
        }

        // Focus trap
        function onKeyDown(e) {
          if (!modal.classList.contains('is-open')) return

          if (e.key === 'Escape') {
            e.preventDefault()
            closeModal()
            return
          }

          if (e.key === 'Tab') {
            const focusables = getFocusableElements(modal)
            if (focusables.length === 0) {
              e.preventDefault()
              modal.focus()
              return
            }
            const first = focusables[0]
            const last = focusables[focusables.length - 1]
            if (e.shiftKey && document.activeElement === first) {
              e.preventDefault()
              last.focus()
            } else if (!e.shiftKey && document.activeElement === last) {
              e.preventDefault()
              first.focus()
            }
          }
        }

        // Backdrop click closes (but ignore clicks inside modal)
        function onBackdropClick(e) {
          if (e.target === backdrop) {
            closeModal()
          }
        }

        function printAllSteps() {
          const steps = document.querySelectorAll('.step')
          const activeIndex = [...steps].findIndex(s =>
            s.classList.contains('active')
          )

          // Show all steps
          steps.forEach(s => s.classList.add('active'))

          // Print
          window.print()

          // Restore previous step after print
          setTimeout(() => {
            steps.forEach((s, i) => {
              s.classList.toggle('active', i === activeIndex)
            })
          }, 500)
        }

        function updateProgress() {
          const percent = Math.round(
            ((currentStep + 1) / stepDefs.length) * 100
          )

          if (currentStep === 0) {
            bar.style.width = '0%'
          } else {
            bar.style.width = percent + '%'
          }

          stepMeta.textContent = `Step ${currentStep + 1} of ${stepDefs.length}`

          // chip states

          Array.from(chipsWrap.children).forEach((chip, i) => {
            chip.classList.toggle('active', i === currentStep)

            chip.classList.remove('done', 'blocked')

            if (i < currentStep) chip.classList.add('done')

            if (i > currentStep) chip.classList.add('blocked')
          })
        }

        function showStep(i) {
          steps.forEach(s => s.classList.remove('active'))

          steps[i].classList.add('active')

          currentStep = i

          updateProgress()

          updateButtons()

          refreshOutputPreview()

          window.scrollTo({ top: 0, behavior: 'smooth' })
        }

        function updateButtons() {
          if (currentStep === 0) {
            $('btnPrev').disabled = true
            $('btnPrev').classList.add('hidden')
          } else {
            $('btnPrev').disabled = false
            $('btnPrev').classList.remove('hidden')
          }

          if (currentStep === stepDefs.length - 1) {
            $('btnNext').disabled = true
            $('btnNext').classList.add('hidden')
          } else {
            $('btnNext').disabled = false
            $('btnNext').classList.remove('hidden')
          }

          if (currentStep !== stepDefs.length - 1) {
            $('btnSubmit').disabled = true
            $('btnSubmit').classList.add('hidden')
          } else {
            $('btnSubmit').disabled = false
            $('btnSubmit').classList.remove('hidden')
          }

          // Disable Print and Export Button
          if (currentStep < 2) {
            $('btnPrint').disabled = true
            $('btnExportCSV').disabled = true
            $(
              'footer-helper'
            ).textContent = `Disclaimer: All the information provided is subject to verification by Johnson & Johnson.`
          } else {
            $('btnPrint').disabled = false
            $('btnExportCSV').disabled = false
            $(
              'footer-helper'
            ).textContent = `Thank you for filling out the details! Selecting Submit will open your mailbox to proceed.`
          }
        }

        // ---------- Validation ----------

        function setFieldError(id, message) {
          const el = $(id)

          if (!el) return

          const err = document.querySelector(`.field-error[data-for="${id}"]`)

          if (message) {
            el.classList.add('invalid')

            el.classList.remove('valid')

            if (err) {
              err.style.display = 'block'

              err.textContent = message
            }
          } else {
            el.classList.remove('invalid')

            if (String(el.value || '').trim()) el.classList.add('valid')
            else el.classList.remove('valid')

            if (err) {
              err.style.display = 'none'

              err.textContent = ''
            }
          }
        }

        function isVisible(el) {
          // hidden by blocks (display:none) -> offsetParent null

          return el && el.offsetParent !== null
        }

        function validateField(el) {
          if (!el || !isVisible(el)) return true

          const id = el.id

          const label = el.getAttribute('data-label') || id

          const required = el.getAttribute('data-required') === 'true'

          const type = el.getAttribute('data-type') || ''

          const v = String(el.value || '')

          if (required && !v) {
            setFieldError(id, `${label} is required.`)

            return false
          }

          if (v) {
            if (type === 'email') {
              if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)) {
                setFieldError(id, `${label} must be a valid email format.`)

                return false
              }
            }

            // if (type === 'state2') {
            //   if (v.length !== 2 || !/^[A-Za-z]{2}$/.test(v)) {
            //     setFieldError(id, `${label} must be 2 letters (e.g., MI).`)

            //     return false
            //   }
            // }

            if (type === 'postal') {
              // allow US ZIP or general alnum (corporate forms vary)

              if (!/^[A-Za-z0-9 -]{3,12}$/.test(v)) {
                setFieldError(id, `${label} looks invalid.`)

                return false
              }
            }

            if (label === 'Contact Number') {
              // Enforce digits-only and write back
              const digitsOnly = String(v).replace(/\D+/g, '')
              if (el.value !== digitsOnly) el.value = digitsOnly

              // Require at least 7 digits if provided
              if (digitsOnly.length > 0 && digitsOnly.length < 7) {
                setFieldError(id, `${label} must have at least 7 digits.`)
                return false
              }
            }

            if (
              label === 'Full Name (First & Last)' ||
              label === 'Business Contact Name'
            ) {
              // 1) Keep letters (Unicode), combining marks, spaces, hyphens, apostrophes
              //    Remove everything else (including digits and symbols)
              let cleaned = String(el.value).replace(/[^\p{L}\p{M}\s'-]/gu, '')

              // If the element's value changed, update it
              if (el.value !== cleaned) el.value = cleaned

              // 3) Validate: must not be empty after cleanup
              if (cleaned.length === 0) {
                setFieldError(
                  id,
                  `${label} cannot contain numbers or be empty.`
                )
                return false
              }
            }
          }

          setFieldError(id, '')

          return true
        }

        function validateStep(stepIndex) {
          const stepEl = steps[stepIndex]

          const inputs = Array.from(
            stepEl.querySelectorAll('input, select, textarea')
          )

          // ignore radios (validated as group only if required, which we don't enforce here)

          // .filter(el => el.type !== 'radio' && el.type !== 'checkbox')

          let ok = true

          errorsBox.style.display = 'none'

          errorsBox.textContent = ''

          inputs.forEach(el => {
            if (!validateField(el)) ok = false
          })

          // Extra rule: if GPO Aff = Yes, at least one GPO field should be filled (optional but helpful)

          if (stepIndex === 3) {
            const gpoYes =
              document.querySelector('input[name="gpoAff"]:checked')?.value ===
              'Yes'

            if (gpoYes) {
              const gpoId = $('gpoId').value.trim()

              const gpoName = $('gpoName').value.trim()

              if (!gpoId && !gpoName) {
                ok = false

                errorsBox.style.display = 'block'

                errorsBox.textContent =
                  'GPO Affiliation is Yes — please provide at least GPO ID or GPO Name.'
              }
            }
          }

          if (!ok && errorsBox.style.display !== 'block') {
            errorsBox.style.display = 'block'

            errorsBox.textContent =
              'Please correct the highlighted fields before proceeding.'
          }

          return ok
        }

        // Live validation

        document.addEventListener('input', e => {
          const el = e.target

          if (!el || !el.matches('input,select,textarea')) return

          if (el.type === 'radio' || el.type === 'checkbox') return

          validateField(el)

          refreshOutputPreview()

          autosyncCopies()
        })

        // ---------- Smart Copy Logic (Bill-To / Pay-From) ----------

        const shipKeys = [
          'Addr1',
          'AddrType1',
          'AddrTypeValue1',
          'FacilityName',
          'ClassOfTrade',
          'POBoxNumber',
          'City',
          'State',
          'Postal'
        ]

        const billKeys = [
          'Addr1',
          'AddrType1',
          'AddrTypeValue1',
          'FacilityName',
          'ClassOfTrade',
          'POBoxNumber',
          'City',
          'State',
          'Postal'
        ]

        const payKeys = [
          'Addr1',
          'AddrType1',
          'AddrTypeValue1',
          'FacilityName',
          'ClassOfTrade',
          'POBoxNumber',
          'City',
          'State',
          'Postal'
        ]

        function copy(prefixFrom, prefixTo, keys) {
          keys.forEach(k => {
            const from = $(`${prefixFrom}${k}`)

            const to = $(`${prefixTo}${k}`)

            if (from && to) to.value = from.value || ''
          })
        }

        function setReadonly(prefix, keys, on) {
          keys.forEach(k => {
            const el = $(`${prefix}${k}`)

            if (el) el.readOnly = on
          })
        }

        function autosyncCopies() {
          // Bill same as Ship

          if ($('billSameAsShip').checked) {
            copy('ship', 'bill', billKeys)

            setReadonly('bill', billKeys, true)
          } else {
            setReadonly('bill', billKeys, false)
          }

          // Pay-from mode locks pay fields and copies

          const mode =
            document.querySelector('input[name="payFromMode"]:checked')
              ?.value || 'ship'

          setReadonly('pay', payKeys, true)

          if (mode === 'ship') copy('ship', 'pay', payKeys)

          if (mode === 'bill') copy('bill', 'pay', payKeys)
        }

        function wireCopyToggles() {
          $('billSameAsShip').addEventListener('change', () => {
            autosyncCopies()

            setStatus(
              $('billSameAsShip').checked
                ? 'Bill-To locked to Ship-To.'
                : 'Bill-To unlocked.'
            )
          })

          document.querySelectorAll('input[name="payFromMode"]').forEach(r => {
            r.addEventListener('change', () => {
              autosyncCopies()

              const mode = document.querySelector(
                'input[name="payFromMode"]:checked'
              )?.value

              setStatus(
                mode === 'ship'
                  ? 'Pay-From locked to Ship-To.'
                  : 'Pay-From locked to Bill-To.'
              )
            })
          })
        }

        // ---------- Restore Dropdowns ----------

        function restoreDropdownState() {
          const yes =
            document.querySelector('input[name="gpoAff"]:checked')?.value ===
            'Yes'

          $('gpoBlock').style.display = yes ? 'block' : 'none'
        }

        // ---------- Conditional Blocks ----------

        function wireConditionals() {
          document.querySelectorAll('input[name="gpoAff"]').forEach(r => {
            r.addEventListener('change', () => {
              const yes =
                document.querySelector('input[name="gpoAff"]:checked')
                  ?.value === 'Yes'

              $('gpoBlock').style.display = yes ? 'block' : 'none'

              refreshOutputPreview()
            })
          })

          document.querySelectorAll('input[name="ethiconBio"]').forEach(r => {
            r.addEventListener('change', () => {
              const yes =
                document.querySelector('input[name="ethiconBio"]:checked')
                  ?.value === 'Yes'

              $('bioBlock').style.display = yes ? 'block' : 'none'

              refreshOutputPreview()
            })
          })
        }

        // ---------- Data Export ----------

        function collectData() {
          const data = {}

          const all = Array.from(
            document.querySelectorAll('input,select,textarea')
          )

          all.forEach(el => {
            if (!el.name && !el.id) return

            // skip hidden blocks (but keep radios/checkboxes as they represent selections)

            // if ((el.type !== "radio" && el.type !== "checkbox") && !isVisible(el)) return;

            const key = el.name || el.id

            if (el.type === 'radio') {
              if (el.checked) data[key] = el.value

              return
            }

            if (el.type === 'checkbox') {
              data[key] = !!el.checked

              return
            }

            const v = String(el.value || '').trim()

            if (v !== '') data[key] = v
          })

          return data
        }

        function toCSVRow(obj) {
          // stable, sorted headers for repeatability

          const headers = Object.keys(obj).sort()

          const escape = s => `"${String(s).replace(/"/g, '""')}"`

          const row = headers.map(h => escape(obj[h] ?? '')).join(',')

          return { headers, csv: headers.join(',') + '\n' + row + '\n' }
        }

        function downloadText(filename, text, mime = 'text/plain') {
          const blob = new Blob([text], { type: mime })

          const url = URL.createObjectURL(blob)

          const a = document.createElement('a')

          a.href = url

          a.download = filename

          document.body.appendChild(a)

          a.click()

          a.remove()

          URL.revokeObjectURL(url)
        }

        function refreshOutputPreview() {
          // only show preview on final step, but keep it updated always

          const data = collectData()

          if (outputEl) outputEl.textContent = JSON.stringify(data, null, 2)
        }

        // ---------- Draft ----------

        function saveDraft() {
          if (
            !confirm(
              'Are you sure you want to save this as a draft? The previously saved draft will be overwritten.'
            )
          )
            return
          const data = collectData()

          localStorage.setItem(
            DRAFT_KEY,
            JSON.stringify({ savedAt: new Date().toISOString(), data })
          )

          setStatus('Draft saved to this browser (local storage).')
        }

        function loadDraft() {
          if (
            !confirm(
              'Are you sure you want to load the draft? Any unsaved changes will be overwritten.'
            )
          )
            return
          clearValidationMessages()
          const raw = localStorage.getItem(DRAFT_KEY)

          if (!raw) {
            setStatus('No draft found in this browser.')

            return
          }

          const parsed = JSON.parse(raw)

          const data = parsed.data || {}

          // set values

          Array.from(
            document.querySelectorAll('input,select,textarea')
          ).forEach(el => {
            const key = el.name || el.id

            if (!key) return

            console.log(key)

            if (el.type === 'radio') {
              el.checked = data[key] === el.value

              return
            }

            if (el.type === 'checkbox') {
              if (typeof data[key] === 'boolean') el.checked = data[key]

              return
            }

            if (data[key] !== undefined) el.value = data[key]

            if (key == 'facilityType') {
              loadFacilityTypeInformation({
                target: { value: el.value }
              })
            }
          })

          autosyncCopies()

          refreshOutputPreview()
          restoreDropdownState()
          setStatus(`Draft loaded (savedAt: ${parsed.savedAt || 'unknown'}).`)
        }

        // ---------- Navigation ----------

        function gotoStep(target, opts = { allowForwardIfValid: false }) {
          if (target < 0 || target >= stepDefs.length) return

          if (target > currentStep) {
            // moving forward

            const ok = validateStep(currentStep)

            if (!ok) return

            // if jumping multiple steps, validate each intermediate step quickly

            if (opts.allowForwardIfValid) {
              for (let i = currentStep + 1; i <= target; i++) {
                // validate previous step after entering it? keep simple: just allow the jump since prior validated
                // and the user may skip optional sections.
              }
            }
          }

          errorsBox.style.display = 'none'

          showStep(target)
        }

        function next() {
          if (!validateStep(currentStep)) return

          gotoStep(currentStep + 1)

          setStatus('OK.')
        }

        function prev() {
          gotoStep(currentStep - 1)

          setStatus('OK.')
        }

        function submit() {
          // validate all steps

          for (let i = 0; i < stepDefs.length; i++) {
            if (!validateStep(i)) {
              showStep(i)

              setStatus('Submission blocked: fix errors.')

              return
            }
          }

          submitViaEmailKeyValue()
        }

        function submitViaEmailKeyValue() {
          const bodyText = `Hello,

                Please see the submitted form details below:

                ${collectDataAsKeyValueText()}

                Thank you.`

          const mailto =
            `mailto:RA-JJCustServAcctUpl@ITS.JNJ.com` +
            `?subject=${encodeURIComponent(
              'MDM Request – Smart Form Submission'
            )}` +
            `&body=${encodeURIComponent(bodyText)}`

          window.location.href = mailto
        }

        function collectDataAsKeyValueText() {
          const lines = []
          const elements = Array.from(
            document.querySelectorAll('input, select, textarea')
          )

          elements.forEach(el => {
            const key = el.name || el.id
            if (!key) return

            // Radio buttons → only checked
            if (el.type === 'radio') {
              if (!el.checked) return
              lines.push(`${key}: ${el.value}`)
              return
            }

            // Checkboxes → true / false
            if (el.type === 'checkbox') {
              lines.push(`${key}: ${el.checked ? 'Yes' : 'No'}`)
              return
            }

            const value = (el.value || '').toString().trim()
            if (value === '') return

            lines.push(`${key}: ${value}`)
          })

          return lines.join('\n')
        }

        function toSingleRowCsv(dataObj) {
          const headers = Object.keys(dataObj).sort()
          const esc = v => `"${String(v ?? '').replace(/"/g, '""')}"`
          const headerLine = headers.map(esc).join(',')
          const valueLine = headers.map(h => esc(dataObj[h])).join(',')
          return headerLine + '\n' + valueLine
        }

        function openMailtoWithCsv({ to, subject, csv }) {
          const body = `Hello,

                  Please see the submitted form data details below:

                  ${csv}

                  Or see the attached file. <attach your downloaded csv/pdf file>

                  Thank you.`

          const mailtoUrl =
            `mailto:${encodeURIComponent(to)}?` +
            `subject=${encodeURIComponent(subject)}&` +
            `body=${encodeURIComponent(body)}`

          window.location.href = mailtoUrl
        }

        function resetAll() {
          if (
            !confirm(
              'Reset the form? This will clear all fields (draft remains stored unless you overwrite it).'
            )
          )
            return

          form.reset()

          errorsBox.style.display = 'none'

          errorsBox.textContent = ''

          // hide blocks, reset readonly copies

          $('gpoBlock').style.display = 'none'

          $('bioBlock').style.display = 'none'

          $('billSameAsShip').checked = true

          document.querySelector(
            'input[name="payFromMode"][value="ship"]'
          ).checked = true

          autosyncCopies()

          clearValidationMessages()
          showStep(0)

          setStatus('Reset complete.')
        }

        function clearValidationMessages() {
          // clear validation visuals

          Array.from(document.querySelectorAll('.invalid,.valid')).forEach(
            el => {
              el.classList.remove('invalid', 'valid')
            }
          )

          Array.from(document.querySelectorAll('.field-error')).forEach(e => {
            e.style.display = 'none'
            e.textContent = ''
          })

          errorsBox.style.display = 'none'

          errorsBox.textContent = ''
        }

        // ----------Hospital Selector ----------

        function loadFacilityTypeInformation(event) {
          const value = event?.target?.value || ''
          let val_text = ''
          switch (value) {
            case '':
              val_text = '' // placeholder/no selection
              break

            case 'Hospital':
              val_text =
                'ℹ️ A comprehensive medical facility providing inpatient and outpatient care, surgery, emergency services, and specialty treatments.'
              break

            case 'Pharmacies':
              val_text =
                'ℹ️ Licensed outlets that dispense prescription medications, provide medication counseling, and offer over-the-counter products.'
              break

            case 'Ambulatory Surgery Center':
              val_text =
                'ℹ️ An outpatient facility where patients receive same-day surgical procedures without overnight stays.'
              break

            case 'Veterinary':
              val_text =
                'ℹ️ Clinics or hospitals that diagnose, treat, and provide surgical care for animals.'
              break

            case 'Physician Account':
              val_text =
                'ℹ️ Independent or group physician practices providing outpatient care under a physician-led organization.'
              break

            case 'Other':
              val_text =
                'A healthcare-related facility type not covered by the listed categories (please specify).'
              break

            case 'Long Term Care':
              val_text =
                'ℹ️ Facilities providing extended residential care and assistance with daily living, often including skilled nursing services.'
              break

            default: // safety fallback
              val_text = ''
              break
          }

          if (value == 'Other') {
            document.querySelector('#facility_section').style.display = 'none'
            document.querySelector('#input_facility_type').style.display =
              'block'
          } else {
            document.querySelector('#facility_section').textContent = val_text
            document.querySelector('#facility_section').style.display = 'block'
            document.querySelector('#input_facility_type').style.display =
              'none'
          }
        }
        //

        function loadIdentificationIDs() {
          // Configuration for the ident types (mirrors your <option> list)
          const IDENT_TYPES = [
            { value: 'NPI', label: 'National Provider Identifier' },
            { value: 'DEA', label: 'DEA Registration Number' },
            { value: 'HIN', label: 'Health Industry Number' },
            { value: 'Tax ID', label: 'Pharmacy License Number' },
            { value: 'GPO', label: 'GPO' },
            { value: 'Other', label: 'Other' }
          ]

          // Utility: create a safe ID suffix
          const toId = value => value.replace(/\s+/g, '-').toLowerCase()

          const identTypeGroup = document.getElementById('identTypeGroup')
          const identInputs = document.getElementById('identInputs')

          // Render checkbox list
          function renderCheckboxes() {
            IDENT_TYPES.forEach(t => {
              const id = `identType_${toId(t.value)}`
              const wrapper = document.createElement('label')
              wrapper.className = 'checkbox-item'
              wrapper.setAttribute('for', id)

              const input = document.createElement('input')
              input.type = 'checkbox'
              input.id = id
              input.name = 'identType[]' // submit as array
              input.value = t.value
              input.dataset.label = t.label

              const text = document.createTextNode(' ' + t.label)

              wrapper.appendChild(input)
              wrapper.appendChild(text)
              identTypeGroup.appendChild(wrapper)

              // Event: toggle corresponding input field
              input.addEventListener('change', () => toggleIdentInput(t))
            })
          }

          // Create or remove the input block for a given type
          function toggleIdentInput(type) {
            const blockId = `identInput_${toId(type.value)}`
            const existing = document.getElementById(blockId)
            const checkbox = document.querySelector(
              `input[type="checkbox"][name="identType[]"][value="${CSS.escape(
                type.value
              )}"]`
            )

            if (checkbox.checked) {
              if (!existing) {
                const block = document.createElement('div')
                block.className = 'ident-input-block'
                block.id = blockId

                const label = document.createElement('label')
                const inputId = `identNumber_${toId(type.value)}`
                label.setAttribute('for', inputId)
                label.textContent = `${type.label} — Identification Number`

                const input = document.createElement('input')
                input.type = 'text'
                input.id = inputId
                input.name = `identNumber[${type.value}]` // grouped by type
                input.placeholder = `Enter ${type.label} ID`
                input.setAttribute('aria-describedby', `${inputId}_err`)
                input.dataset.required = 'true'
                input.dataset.label = `${type.label} Identification Number`

                const err = document.createElement('div')
                err.className = 'field-error'
                err.id = `${inputId}_err`

                block.appendChild(label)
                block.appendChild(input)
                block.appendChild(err)
                identInputs.appendChild(block)
              }
            } else {
              if (existing) existing.remove()
            }
          }

          // Minimal validation example (client-side)
          function validateIdentification() {
            // clear previous errors
            document
              .querySelectorAll('.field-error')
              .forEach(el => (el.textContent = ''))

            const selected = Array.from(
              document.querySelectorAll('input[name="identType[]"]:checked')
            )
            const typeErrorEl = document.querySelector(
              '.field-error[data-for="identType"]'
            )
            const numberErrorEl = document.querySelector(
              '.field-error[data-for="identNumber"]'
            )

            let valid = true

            if (selected.length === 0) {
              typeErrorEl.textContent =
                'Please select at least one Identification Type.'
              valid = false
            }

            // For each visible input, require non-empty
            selected.forEach(cb => {
              const input = document.querySelector(
                `#identNumber_${toId(cb.value)}`
              )
              const err = document.querySelector(
                `#identNumber_${toId(cb.value)}_err`
              )
              if (input && !input.value.trim()) {
                err.textContent = `Please enter a value for ${cb.dataset.label}.`
                valid = false
              } else if (err) {
                err.textContent = ''
              }
            })

            // Optional aggregate error area (kept for compatibility)
            if (!valid && numberErrorEl) {
              numberErrorEl.textContent =
                'One or more identification numbers are required.'
            }

            return valid
          }

          // Hook up to a form submit (optional)
          // If your markup has a <form id="myForm"> wrapper, this will validate before submit.
          document.addEventListener('DOMContentLoaded', () => {
            renderCheckboxes()

            const form = document.querySelector('form') // adjust if needed
            if (form) {
              form.addEventListener('submit', e => {
                if (!validateIdentification()) {
                  e.preventDefault()
                  // Optionally focus first error
                  const firstErrInput =
                    document.querySelector(
                      '.ident-input-block input[aria-describedby$="_err"]:invalid'
                    ) ||
                    document.querySelector('.ident-input-block input') ||
                    document.querySelector('input[name="identType[]"]')
                  if (firstErrInput && firstErrInput.focus)
                    firstErrInput.focus()
                }
              })
            }
          })
        }

        // ---------- Wire Buttons ----------

        function wireButtons() {
          $('btnPrev').addEventListener('click', prev)

          $('btnNext').addEventListener('click', next)

          $('btnSubmit').addEventListener('click', submit)

          $('btnSaveDraft').addEventListener('click', saveDraft)

          $('btnLoadDraft').addEventListener('click', loadDraft)

          $('facilityType').addEventListener(
            'change',
            loadFacilityTypeInformation
          )

          $('btnExportJSON').addEventListener('click', () => {
            // validate current step only (export can be allowed even if incomplete)

            const data = collectData()

            const txt = JSON.stringify(data, null, 2)

            downloadText('form_export.json', txt, 'application/json')

            setStatus('JSON exported.')
          })

          $('btnExportCSV').addEventListener('click', () => {
            const data = collectData()

            const { csv } = toCSVRow(data)

            downloadText(
              'JNJ-Medtech-' + $('fullName')?.value + '.csv',
              csv,
              'text/csv'
            )

            setStatus('CSV exported.')
          })

          $('btnPrint').addEventListener('click', () => printAllSteps())

          $('btnReset').addEventListener('click', resetAll)

          modal.addEventListener('mousedown', onBackdropClick)
          document.addEventListener('keydown', onKeyDown)

          // keyboard convenience

          document.addEventListener('keydown', e => {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
              // Ctrl+Enter submits if on last step, else next

              if (currentStep === stepDefs.length - 1) submit()
              else next()
            }
          })

          document.querySelector('#facility_section').style.display = 'none'
        }

        // ---------- Init ----------

        loadIdentificationIDs()
        renderChips()

        wireButtons()

        wireCopyToggles()

        wireConditionals()

        // Default lock/copy behavior

        autosyncCopies()

        showStep(0)

        refreshOutputPreview()

        setStatus('Ready. Fill Step 1 then click Next.')
        document.querySelector('#input_facility_type').style.display = 'none'
      })()
    </script>
  </body>
</html>
